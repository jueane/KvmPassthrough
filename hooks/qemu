#!/bin/bash

guest_name="$1"
libvirt_task="$2"

if [[ $guest_name == "win11" || $guest_name == "win10" || $guest_name == "ubuntu" || $guest_name == "docker_arch" || $guest_name == "vArch" ]] ; then
	case "$libvirt_task" in
        	"prepare")
                /usr/bin/vm_zfs_snapshot.sh $guest_name 2>&1 | tee -a /var/log/libvirt/custom_hooks.log
                #systemctl start libvirt-nosleep@"$guest_name"  2>&1 | tee -a /var/log/libvirt/custom_hooks.log
                pkill -15 xinit 2>&1 | tee -a /var/log/libvirt/custom_hooks.log
				sleep 5
                # /bin/vfio-startup.sh 2>&1 | tee -a /var/log/libvirt/custom_hooks.log
                ;;

            "release")
                #systemctl stop libvirt-nosleep@"$guest_name"  2>&1 | tee -a /var/log/libvirt/custom_hooks.log
                # /bin/vfio-teardown.sh 2>&1 | tee -a /var/log/libvirt/custom_hooks.log
                ;;
	esac
fi
